# Custom MiG network daemon filter to detect attempts to brute-force guess user passwords 
# and common scanning bots

[DEFAULT]


normal = ^.* ERROR Failed (password|password hash|digest) login for .* from <HOST>$

# Login attempts with system account usernames are a cracking giveway
pw_crack = ^.* ERROR (Invalid username|Failed (password|password hash|digest) login for) __CRACK_USERNAME_REGEX__ from <HOST>(:\d+)?$

# Repeated native sftp handshake errors from weak client security indicate a scan bot
handshake = ^.* WARNING client negotiation errors for \('<HOST>', [0-9]+\): (Incompatible ssh (peer|server) \(no acceptable (kex algorithm|ciphers|macs|host key)\))?$

[INCLUDES]
before = common.conf

[Definition]
failregex = %(normal)s
#ignoreregex =

[Init]
maxlines = 1
# Use pyinotify or poll on native log file rather than systemd journal
#journalmatch = _SYSTEMD_UNIT=migrid.service + _COMM=grid_webdavs.py
journalmatch = 
